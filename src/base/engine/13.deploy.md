---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的vuepress学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 十三.部署上线

::: tip 场景
前端开发需要确认已发布，测试是否成功发布本次项目代码
:::

## 1.部署前

::: warning 注意
有时候部署比较敏感，如上 uat、prod 环境，为了防止出意外导致投诉（如测试或领导），可以先在本地模拟线上环境，校验前端打包后的代码是否是正常的，自己确定修改无误后再部署
:::

- 本地打包代码

  ```sh
  # nginx/conf/nginx.conf
  ...
  location /[项目二级目录] {
    root D:/project/[项目名称]
    try_fiels $uri $uri/ /[打包目录]/index.html
    index index.html index.htm
  }
  ...
  ```

- 本地启用 nginx，验证打包代码（在安装根目录下启用 cmd）

  ```sh
  start nginx           # 启动
  nginx -s stop         # 快速停止（不保存相关信息）
  nginx -s quit         # 有序停止（保存相关信息）
  nginx -s reload       # 重启
  ```

## 2.部署中

- **方式一**：直接上传本地打包后的代码到服务器

  ```sh
  npm run build:sit
  ```

  通过 ftp 等工具将 dist 目录下的打包文件传输到服务器指定目录（服务器上需先启动 nginx）

- **方式二**：通过相关工具部署流水线

## 3.部署后

- 查看代码是否更新

  在 public 下建立文件，/version.json（打包时 webpack 向此文件写入打包信息）

  ```json
  {
    "projectName": "xxx",
    "version": "xxx1.13",
    "date": "2021/12/19",
    "time": "123"
  }
  ```

  main.js

  ```js
  setTimeout(() => {
    axios.get("/version.json").then((res) => {
      if (res.data.time !== localStorage.time) {
        localStorage.time = res.data.time
        message("项目有更新,10s后自动刷新页面")
      }
    })
  }, 10000)
  ```

![](./13.deploy.png)
